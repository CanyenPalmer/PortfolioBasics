/* =========================================================
   MOBILE-ONLY FIXES (≤768px). Desktop/laptop stay unchanged.
   Brand-new approach: unhide hero/about, contain stacking,
   eliminate locked deck, and make long content scroll INSIDE
   experience cards without overlaying other sections.
========================================================= */
@media (max-width: 768px) {

  /* -------------------------------------------------------
     0) Boot/hydration safety – stop "invisible content" on phones
     Your layout inlines:
     html.mach-booting body > *:not(#boot-overlay) { visibility: hidden !important; }
     That hides ALL sections until JS clears the class. If hydration lags on mobile,
     force-override so users still see content.
  -------------------------------------------------------- */
  html.mach-booting body > *:not(#boot-overlay) { visibility: visible !important; }
  #boot-overlay { display: none !important; }

  /* -------------------------------------------------------
     1) Global safety + section paint containment
  -------------------------------------------------------- */
  html, body { overflow-x: hidden; }
  img, video, canvas { max-width: 100%; height: auto; display: block; }

  /* Each major section paints in its own layer to avoid cross-section overlays */
  #home, #about, #experience, #projects, #education, #testimonials, #contact {
    isolation: isolate !important;  /* new stacking context */
    contain: paint !important;      /* confine any child painting to this section */
    position: relative !important;
    z-index: 0 !important;
  }

  /* -------------------------------------------------------
     2) HERO (#home)
     - Toolbar: single row, horizontal scroll
     - Unhide all hero content
     - Stack: text/details FIRST, image LAST
  -------------------------------------------------------- */
  #home { padding-top: 3.5rem; padding-bottom: 1rem; }
  #home .container .grid {
    display: grid !important;
    grid-template-columns: 1fr !important;
    align-items: start !important;
    gap: 1rem !important;
  }
  /* If any hero children were hidden by animations/states, reveal them */
  #home .container .grid > * { opacity: 1 !important; visibility: visible !important; transform: none !important; display: block !important; }

  /* Toolbar as a horizontal, swipeable rail */
  #home > nav {
    position: static !important;
    width: 100% !important;
    margin: 0 0 .5rem 0 !important;
    z-index: 1 !important;
  }
  #home nav ul {
    display: flex !important;
    flex-direction: row !important;
    flex-wrap: nowrap !important;          /* one row */
    overflow-x: auto !important;           /* sideways scroll */
    overflow-y: hidden !important;
    -webkit-overflow-scrolling: touch !important;
    white-space: nowrap !important;
    gap: .75rem !important;
    padding: .25rem .5rem !important;
  }
  #home nav li { flex: 0 0 auto !important; }
  #home nav a { display: inline-flex !important; align-items: center; }

  /* Order: text first, media last (covers common wrappers) */
  #home .container .grid > .space-y-5 { order: 1 !important; }
  #home .container .grid > .justify-self-center,
  #home .container .grid > figure { order: 2 !important; }

  /* -------------------------------------------------------
     3) ABOUT (#about)
     - Ensure visible + single column
  -------------------------------------------------------- */
  #about .grid {
    display: grid !important;
    grid-template-columns: 1fr !important;
    align-items: start !important;
    gap: 1rem !important;
  }
  #about [aria-label="About images"] {
    height: min(60vh, 560px) !important;
    opacity: 1 !important; transform: none !important; overflow: visible !important;
  }
  #about [aria-label="About images"] .absolute { inset: 0 !important; }

  /* -------------------------------------------------------
     4) EXPERIENCE (#experience / [data-section="experience"])
     Goals:
       - Remove duplicate/locked deck
       - Prevent any cross-section overlay
       - Expanded content must be readable; long bodies scroll INSIDE card
       - Slight font-size reduction ONLY on first card (Lead Analyst)
  -------------------------------------------------------- */

  /* Show FLOW deck, hide LOCKED deck (kills duplicates) */
  #experience .stageFlow,  [data-section="experience"] .stageFlow  { display: block !important; opacity: 1 !important; visibility: visible !important; }
  #experience .stageFixed, [data-section="experience"] .stageFixed { display: none !important; }

  /* Remove lock-window heights and sticky headers on phones */
  #experience .lockWindow,      [data-section="experience"] .lockWindow      { height: auto !important; }
  #experience .subheaderSticky, [data-section="experience"] .subheaderSticky { position: static !important; top: auto !important; }

  /* Normalize stage/stack geometry; no transforms (they create overlay contexts) */
  #experience .stageHolder, [data-section="experience"] .stageHolder,
  #experience .stack,       [data-section="experience"] .stack {
    position: static !important; height: auto !important; width: 100% !important;
    transform: none !important; overflow: visible !important; z-index: auto !important;
  }

  /* NO cross-section overlay: neutralize fixed/sticky/absolute descendants */
  #experience *[style*="position: fixed"],
  #experience *[style*="position: sticky"],
  #experience *[style*="position: absolute"],
  [data-section="experience"] *[style*="position: fixed"],
  [data-section="experience"] *[style*="position: sticky"],
  [data-section="experience"] *[style*="position: absolute"] {
    position: static !important; top: auto !important; left: auto !important; right: auto !important; bottom: auto !important;
    z-index: auto !important; transform: none !important;
  }

  /* Cards flow in document order; no lateral slide offsets */
  #experience .card, [data-section="experience"] .card {
    position: relative !important; inset: auto !important;
    width: 100% !important; max-width: none !important;
    margin: 0 0 1rem 0 !important;
    transform: none !important; opacity: 1 !important; transition: none !important;
    overflow: visible !important; background: rgba(13,19,29,0.98) !important; backdrop-filter: none !important;
    z-index: 0 !important;               /* rely on section’s isolated stack */
    scroll-margin-top: 100px !important; /* when focusing a card, start near top */
  }

  /* Expanded body becomes a CONTAINED scroll region (fits phone viewport) */
  /* Use resilient substring targets — CSS modules often hash class names */
  #experience .card [class*="detail"],
  #experience .card [class*="content"],
  #experience .card [class*="body"],
  #experience .card [class*="inner"],
  #experience .card [class*="panel"],
  #experience .card [class*="expand"],
  [data-section="experience"] .card [class*="detail"],
  [data-section="experience"] .card [class*="content"],
  [data-section="experience"] .card [class*="body"],
  [data-section="experience"] .card [class*="inner"],
  [data-section="experience"] .card [class*="panel"],
  [data-section="experience"] .card [class*="expand"] {
    max-height: min(72vh, calc(100vh - 140px)) !important; /* inner scroll size */
    overflow: auto !important; -webkit-overflow-scrolling: touch !important;
    overscroll-behavior: contain !important;
    padding-top: 6px !important; padding-bottom: 10px !important;
    clip-path: none !important; -webkit-mask-image: none !important; mask-image: none !important;
  }

  /* Nuke any inline caps/masks/transforms that can hide content */
  #experience .card *[style*="max-height"],
  #experience .card *[style*="clip-path"],
  #experience .card *[style*="mask-image"],
  #experience .card *[style*="-webkit-mask-image"],
  #experience .card *[style*="transform"],
  [data-section="experience"] .card *[style*="max-height"],
  [data-section="experience"] .card *[style*="clip-path"],
  [data-section="experience"] .card *[style*="mask-image"],
  [data-section="experience"] .card *[style*="-webkit-mask-image"],
  [data-section="experience"] .card *[style*="transform"] {
    max-height: none !important; clip-path: none !important; -webkit-mask-image: none !important; mask-image: none !important; transform: none !important;
  }

  /* Slight type trim ONLY on the first (Lead Analyst) card for better fit */
  #experience .card:first-of-type,
  [data-section="experience"] .card:first-of-type {
    font-size: 0.94em !important; line-height: 1.45 !important;
  }

  /* Metrics: single column for readability on phones */
  #experience .metricsGrid, [data-section="experience"] .metricsGrid { grid-template-columns: 1fr !important; }

  /* -------------------------------------------------------
     5) TESTIMONIALS (#testimonials)
     - Keep desktop text styles; just restructure as sections
     - Image directly below details for each item
     - No sticky/fixed traps; no mega-column
  -------------------------------------------------------- */
  /* Each desktop row/pair becomes an isolated stacked section on mobile */
  #testimonials [class*="md:flex-row"],
  #testimonials [class*="md:flex-row-reverse"] {
    display: flex !important;
    flex-direction: column !important;
    align-items: stretch !important;
    gap: .9rem !important;
    margin-bottom: 1.25rem !important;
    isolation: isolate !important; contain: paint !important;
    position: relative !important; z-index: 0 !important;
  }

  /* Normalize order from desktop alternation */
  #testimonials [class*="md:flex-row-reverse"] > :first-child { order: 2 !important; }
  #testimonials [class*="md:flex-row-reverse"] > :last-child  { order: 1 !important; }

  /* Force image container below text — works whether it’s figure or a media div */
  #testimonials figure,
  #testimonials [class*="image"],
  #testimonials [class*="img"],
  #testimonials [class*="media"] {
    order: 2 !important; width: 100% !important;
  }
  #testimonials img { width: 100% !important; height: auto !important; display: block !important; }

  /* Kill sticky/fixed inside testimonials to avoid scroll traps */
  #testimonials *[style*="position: sticky"],
  #testimonials *[style*="position: fixed"] { position: static !important; top: auto !important; z-index: auto !important; }
}

















